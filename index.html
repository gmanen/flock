<!DOCTYPE html>
<html lang="fr">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <meta charset="utf-8">
</head>
<body>
<div class="container">
    <h1>Shoaks</h1>
    <p class="lead">Building an ecosystem with AI-driven preys and predators</p>
    <div class="mt-2 mb-2" style="margin-left: 50%; transform: translateX(-50%);" id="sketch"></div>
    <form>
        <hr/>
        <div class="custom-control custom-switch">
            <input id="display-pov" class="custom-control-input" type="checkbox" checked/>
            <label for="display-pov" class="custom-control-label">Display shoak POV</label>
        </div>
        <div class="custom-control custom-switch">
            <input id="debug" class="custom-control-input" type="checkbox" checked/>
            <label for="debug" class="custom-control-label">Debug</label>
        </div>
        <hr/>
        <div class="d-flex">
            <div class="d-flex flex-column flex-fill mr-4">
                <div class="form-group">
                    <label for="shoaks-population-slider">
                        Shoak population (<span class="shoaks-population-current">30</span>)
                    </label>
                    <input id="shoaks-population-slider" class="custom-range" type="range" min="1" max="50" value="30"/>
                    <small class="form-text text-muted">
                        Population size has a significant impact on performance when a new generation starts and all shoaks are alive.
                    </small>
                </div>
                <div class="form-group">
                    <label for="shoaks-mutation-rate-slider">
                        Shoak mutation rate (<span class="shoaks-mutation-rate-current">20</span>%)
                    </label>
                    <input id="shoaks-mutation-rate-slider" class="custom-range" type="range" min="5" max="40"
                           step="5" value="20"/>
                    <small class="form-text text-muted">
                        Chance for each neuron of the neural network to mutate when reproducing.
                    </small>
                </div>
                <div class="form-group">
                    <label for="shoaks-hunger-rate-slider">
                        Shoak hunger rate (<span class="shoaks-hunger-rate-current">0.05</span>)
                    </label>
                    <input id="shoaks-hunger-rate-slider" class="custom-range" type="range" min="0.01" max="0.1"
                           step="0.01"
                           value="0.05"/>
                    <small class="form-text text-muted">
                        Mass lost each cycle. A higher value means the shoaks will die quicker.
                    </small>
                </div>
            </div>
            <div class="d-flex flex-column flex-fill mr-4">
                <div class="form-group">
                    <label for="shoaks-perception-radius-slider">
                        Shoak perception radius (<span class="shoaks-perception-radius-current">200</span> pixels)
                    </label>
                    <input id="shoaks-perception-radius-slider" class="custom-range" type="range" min="100" max="500"
                           step="50" value="200"/>
                </div>
                <div class="form-group">
                    <label for="shoaks-fov-slider">
                        Shoak field of view (<span class="shoaks-fov-current">90</span>Â°)
                    </label>
                    <input id="shoaks-fov-slider" class="custom-range" type="range" min="45" max="180"
                           step="5" value="90"/>
                </div>
                <div class="form-group">
                    <label for="shoaks-resolution-slider">
                        Shoak resolution (<span class="shoaks-resolution-current">0.5</span>)
                    </label>
                    <input id="shoaks-resolution-slider" class="custom-range" type="range" min="0.5" max="2"
                           step="0.5" value="0.5"/>
                    <small class="form-text text-muted">
                        Number of ray for each degree of the shoaks' FOV.<br>
                        Increasing this value improves the quality of the shoaks' sight.<br>
                        Keeping a high resolution with a wider field of view angle will have a significant (adverse) impact on performance.
                    </small>
                </div>
            </div>
            <div class="d-flex flex-column flex-fill">
                <div class="form-group">
                    <label for="shoaks-nn-complexity-slider">
                        Shoak neural net complexity (<span class="shoaks-nn-complexity-current">2</span>)
                    </label>
                    <input id="shoaks-nn-complexity-slider" class="custom-range" type="range" min="1" max="3" step="1"
                           value="2"/>
                    <small class="form-text text-muted">
                        Number of layers of neurons in the neural network of each shoak.<br>
                        Increasing this value basically means the shoaks will have more computational power, but will
                        take longer to learn.
                    </small>
                </div>
                <div class="form-group">
                    <label for="shoaks-nn-size-slider">
                        Shoak neural net size (<span class="shoaks-nn-size-current">12</span>)
                    </label>
                    <input id="shoaks-nn-size-slider" class="custom-range" type="range" min="5" max="25" step="1"
                           value="12"/>
                    <small class="form-text text-muted">
                        Number of neurons in each layer.<br>
                        Increasing this value as the same effect as increasing the complexity, but on a lesser scale.
                    </small>
                </div>
            </div>
        </div>
        <hr/>
    </form>
    <h2>How it works</h2>
    <p>
        On the left, you can see a top-down view of an environment where a simulation of a shoak (the circle) and a
        school of fish (the triangles) evolve. On the right is a representation of the first person point of view of the
        shoak. There are <span class="shoaks-population-current">20</span> "fishbowls" running in parallel, only the one
        featuring the best shoak is displayed. At the start and when a new generation is born, the view may flicker a
        lot as it switches between the different shoaks in the population before one of them takes the lead.
    </p>
    <p>
        The fishes are currently moving randomly, only following a flocking algorithm. They try to align with each other
        and group themselves. There is no AI behind their movement.<br>
        An AI - an artificial neural network, or digital brain - drives the shoak. The neural network has two outputs
        (takes two decisions) every frame. The first output is a direction towards which to turn. The second output is
        how much it wants to move forward in that direction. It makes those decisions according to what it can see - the
        right-hand side of the scene.
    </p>
    <p>
        Both the shoaks and the fishes have a mass. The shoaks loses mass every frame and has to eat the fishes to gain
        mass. If a shoak's mass goes down to 0, it dies. The mass is represented visually by the size of the shoaks /
        fishes. The more massive shoaks are, the easier it is for them to eat fishes (they have a longer eating range),
        but the slower they move. Same goes for the fishes, the smaller, less massive ones are faster (and are not as
        nutritious for the shoak).
    </p>
    <p>
        The shoaks learn via a genetic evolution algorithm. When all of the shoaks are dead, a new generation is born,
        evolved from the best performing shoak of the previous generation. The evolution consists of mutating the neural
        network of the shoaks who are selected for reproduction.<br>
        The shoaks are selected for reproduction randomly; those who are more efficient at eating fish are
        more likely to reproduce. Currently, the reproduction is asexual: an individual chosen for reproduction clones
        itself and the resulting child is mutated to form a new individual for the next generation.
    </p>
    <h2>Going forward</h2>
    <p>There is still a lot to do with this mini project, including</p>
    <ul>
        <li>Give the fishes a neural network and try to have them learn to avoid the shoaks</li>
        <li>Have all the shoaks and the fishes be in the same environment</li>
        <li>Try and incentivize the shoaks to work together</li>
        <li>Add currents forcing movement on the shoaks and fishes</li>
        <li>Add obstacles in the environment, providing fishes a way to maybe hide from the shoaks</li>
        <li>
            Currently, the shoaks have no memory; all decisions taken by the neural net are based on the information
            gathered from the current frame only. Give the shoaks memory would maybe allow them to see patterns in the
            fish movements
        </li>
        <li>Go 3D</li>
    </ul>
    <h2>Thanks</h2>
    <p>
        This project is based on the excellent videos of Daniel Shiffman and his youtube channel
        <a target="_blank" href="https://www.youtube.com/user/shiffman">Coding Train</a>, which I recommend you check
        out.
    </p>
    <p>
        The flocking algorithm is based on Craig Reynolds "<a target="_blank" href="https://www.red3d.com/cwr/boids/">boids</a>"
        algorithm.
    </p>
    <p>
        Some optimizations for the mutation algorithm were made thanks to a paper by David Montana on neural network
        weight selection using genetic algorithm found
        <a target="_blank" href="http://davidmontana.net/papers/hybrid.pdf">here.</a>
    </p>
    <h2>On the technical side</h2>
    <p>
        The project is developed with <a target="_blank" href="https://p5js.org/">p5.js.</a><br>
        Code is available on GitHub: <a target="_blank" href="https://github.com/gmanen/shoaks">https://github.com/gmanen/shoaks</a>
    </p>
    <p>
        Originally the shoaks and fishes were all in the same environment, but it was much harder to find the right
        balance for the hyperparameters.
    </p>
    <p>
        The first try at a neural net for the shoaks was a simple feed-forward with a sigmoid activation function. It
        did not work well at all; most shoaks ended up going in a circle (always choosing the same rotation angle).
        Changing the activation function for ReLU was a significant improvement in their learning capacity. I guess it
        makes sense as sigmoid-ish activation functions seem to be more useful for classification problem whereas the
        rotation decision is continuous.
    </p>
    <p>
        I developed the neural network from scratch. I use this mini-project to learn more about neural nets and machine
        learning in general.
    </p>
    <p>
        Currently, the shoaks see in black and white, and only fishes. I want to add colors which would be a way to have
        them see other shoaks, obstacles, walls and such as well as fishes. It probably requires a more complex neural
        net, however.
    </p>
    <p>
        At the moment the reproduction is purely asexual (clone and mutation). I intend to implement crossover and maybe
        randomly decide for each new individual in the next generation if it's born via asexual or sexual reproduction.
    </p>
</div>
<script src="quadtree.js"></script>
<script src="graveyard.js"></script>
<script src="brain.js"></script>
<script src="population.js"></script>
<script src="motile.js"></script>
<script src="sighted.js"></script>
<script src="foish.js"></script>
<script src="shoak.js"></script>
<script src="sketch.js"></script>
</body>
</html>
